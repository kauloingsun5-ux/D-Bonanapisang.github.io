<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kasir D'bonana - Final Report Version</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- General Setup & Fonts --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f5a623;
            --background-color: #1e1e2e;
            --surface-color: #2a2a3e;
            --text-color: #e0e0e0;
            --text-secondary: #a0a0a0;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --border-radius: 12px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* --- Header --- */
        .header { background-color: var(--surface-color); padding: 1rem 1.5rem; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .header h1 { font-size: 1.5rem; font-weight: 600; color: var(--primary-color); }
        .header-actions { display: flex; gap: 0.5rem; }
        .header-btn { background-color: var(--surface-color); color: white; border: 1px solid #444; padding: 0.5rem 0.8rem; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
        .header-btn.active { background-color: var(--primary-color); border-color: var(--primary-color); }

        /* --- Main Views --- */
        .main-view { display: none; flex: 1; padding: 1.5rem; overflow: hidden; }
        .main-view.active { display: flex; }

        /* --- Cashier View --- */
        #view-cashier { gap: 1.5rem; }
        .menu-section { flex: 2; background-color: var(--surface-color); border-radius: var(--border-radius); padding: 1.5rem; overflow-y: auto; }
        .menu-category h2 { font-size: 1.1rem; margin: 1.5rem 0 1rem; color: var(--secondary-color); border-bottom: 2px solid var(--secondary-color); padding-bottom: 0.3rem; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem; }
        .menu-item { background-color: var(--background-color); border: 1px solid #444; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer; transition: 0.2s; }
        .menu-item:hover { transform: translateY(-3px); border-color: var(--primary-color); }
        .menu-item i { font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--text-secondary); }

        .order-section { flex: 1; display: flex; flex-direction: column; background-color: var(--surface-color); border-radius: var(--border-radius); overflow: hidden; }
        .order-items { flex-grow: 1; overflow-y: auto; padding: 1rem; }
        .order-item { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; background: var(--background-color); border-radius: 8px; margin-bottom: 0.5rem; }
        .order-summary { padding: 1rem; background: #222; border-top: 1px solid #444; }

        /* --- Dashboard / Report Style --- */
        .stat-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: var(--surface-color); padding: 1.5rem; border-radius: var(--border-radius); border-left: 4px solid var(--primary-color); }
        .stat-card h3 { font-size: 0.9rem; color: var(--text-secondary); }
        .stat-card p { font-size: 1.5rem; font-weight: 700; color: white; }

        .table-container { background: var(--surface-color); border-radius: var(--border-radius); padding: 1rem; overflow-x: auto; margin-top: 1.5rem; }
        table { width: 100%; border-collapse: collapse; min-width: 500px; }
        th { text-align: left; padding: 1rem; border-bottom: 2px solid #444; color: var(--secondary-color); }
        td { padding: 1rem; border-bottom: 1px solid #444; font-size: 0.9rem; }

        /* --- Modals --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); }
        .modal-content { background-color: var(--surface-color); margin: 5vh auto; padding: 1.5rem; width: 90%; max-width: 500px; border-radius: var(--border-radius); max-height: 85vh; overflow-y: auto; }
        .btn-final-pay { width: 100%; padding: 1rem; background: var(--success-color); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; margin-top: 1rem; }

        @media (max-width: 768px) {
            body { overflow: auto; height: auto; }
            .main-view { flex-direction: column; padding: 0.5rem; overflow: visible; }
            .order-section { height: 400px; margin-top: 1rem; }
        }
    </style>
</head>
<body>

    <header class="header">
        <h1><i class="fas fa-bowl-food"></i> D'bonana</h1>
        <div class="header-actions">
            <button class="header-btn active" id="cashier-btn">Kasir</button>
            <button class="header-btn" id="dashboard-btn">Laporan</button>
        </div>
    </header>

    <main id="view-cashier" class="main-view active">
        <section class="menu-section" id="menu-section"></section>
        <section class="order-section">
            <div style="padding: 10px; background: #333; font-size: 0.8rem; text-align: center;" id="current-date"></div>
            <div class="order-items" id="order-items"></div>
            <div class="order-summary">
                <div class="summary-row total" style="display:flex; justify-content:space-between;"><span>Total:</span><span id="total">Rp 0</span></div>
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button class="btn-final-pay" style="background: var(--danger-color);" id="cancel-btn">Reset</button>
                    <button class="btn-final-pay" id="pay-btn">Bayar</button>
                </div>
            </div>
        </section>
    </main>

    <main id="view-dashboard" class="main-view">
        <div style="width: 100%; overflow-y: auto; padding-right: 10px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2>Laporan Penjualan</h2>
                <button id="delete-report-btn" class="header-btn" style="background: var(--danger-color); border:none;">Hapus Semua Data</button>
            </div>

            <div class="stat-cards">
                <div class="stat-card">
                    <h3>Total Omzet</h3>
                    <p id="stat-revenue">Rp 0</p>
                </div>
                <div class="stat-card" style="border-left-color: var(--secondary-color);">
                    <h3>Total Box Terjual</h3>
                    <p id="stat-boxes">0 Box</p>
                </div>
            </div>

            <div style="background: var(--surface-color); padding: 1rem; border-radius: 8px; height: 300px;">
                <canvas id="sales-chart"></canvas>
            </div>

            <div class="table-container">
                <h3>Riwayat Penjualan</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Waktu / Tanggal</th>
                            <th>Item Pesanan</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="sales-table-body"></tbody>
                </table>
            </div>
        </div>
    </main>

    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                <h3>Pembayaran</h3>
                <span style="cursor: pointer;" id="close-payment-modal">&times;</span>
            </div>
            <div class="payment-methods">
                <div class="payment-method active" data-method="cash">Tunai</div>
                <div class="payment-method" data-method="transfer">Transfer</div>
                <div class="payment-method" data-method="qris">QRIS</div>
            </div>
            <div id="payment-details" style="background: var(--background-color); padding: 1rem; border-radius: 8px;"></div>
            <button class="btn-final-pay" id="btn-final-pay">Selesaikan Transaksi</button>
        </div>
    </div>

    <div id="receipt-modal" class="modal">
        <div class="modal-content" style="background: white; color: black; max-width: 350px;">
            <div id="receipt-content" style="font-family: monospace; white-space: pre-wrap;"></div>
            <button onclick="window.print()" class="btn-final-pay" style="background: var(--primary-color);">Cetak</button>
            <button id="close-receipt-modal" class="btn-final-pay" style="background: #999;">Tutup</button>
        </div>
    </div>

    <script>
        const menuData = [
            // D'bonana Menu
                { id: 1, category: 'D\'bonana', name: 'Ori', price: 14000, icon: 'fa-star' },
                { id: 2, category: 'D\'bonana', name: 'Susu', price: 15000, icon: 'fa-glass-water' },
                { id: 3, category: 'D\'bonana', name: 'Coklat', price: 18000, icon: 'fa-ice-cream' },
                { id: 4, category: 'D\'bonana', name: 'Keju', price: 18000, icon: 'fa-cheese' },
                { id: 5, category: 'D\'bonana', name: 'Palm Sugar', price: 18000, icon: 'fa-cube' },
                { id: 6, category: 'D\'bonana', name: 'Tiramisu', price: 18000, icon: 'fa-bowl-food' },
                { id: 7, category: 'D\'bonana', name: 'Matcha', price: 18000, icon: 'fa-leaf' },
                { id: 8, category: 'D\'bonana', name: 'Oreo', price: 18000, icon: 'fa-cookie' },
                // D'bonana Mix
                { id: 7, category: 'Mix', name: 'Coklat - Tiramisu', price: 20000, icon: 'fa-blender' },
                { id: 8, category: 'Mix', name: 'Coklat - Oreo', price: 20000, icon: 'fa-blender' },
                { id: 9, category: 'Mix', name: 'Coklat - Matcha', price: 20000, icon: 'fa-blender' },
                { id: 10, category: 'Mix', name: 'Tiramisu - Matcha', price: 20000, icon: 'fa-blender' },
                { id: 11, category: 'Mix', name: 'Tiramisu - Oreo', price: 20000, icon: 'fa-blender' },
                { id: 12, category: 'Mix', name: 'Matcha - Oreo', price: 20000, icon: 'fa-blender' },
                { id: 13, category: 'Mix', name: 'palm-matcha', price: 20000, icon: 'fa-blender' },
                { id: 14, category: 'Mix', name: 'palm-coklat', price: 20000, icon: 'fa-blender' },
                { id: 15, category: 'Mix', name: 'palm-tiramisu', price: 20000, icon: 'fa-blender' },
                { id: 16, category: 'Mix', name: 'palm-oreo', price: 20000, icon: 'fa-blender' },
                { id: 17, category: 'Mix', name: 'Keju - Coklat', price: 23000, icon: 'fa-blender' },
                { id: 18, category: 'Mix', name: 'Keju - Tiramisu', price: 23000, icon: 'fa-blender' },
                { id: 19, category: 'Mix', name: 'Keju - Matcha', price: 23000, icon: 'fa-blender' },
                { id: 20, category: 'Mix', name: 'Keju - Oreo', price: 23000, icon: 'fa-blender' },
                { id: 21, category: 'Mix', name: 'keju-palm', price: 23000, icon: 'fa-blender' },
                                 
                // Ketan Susu Menu
                { id: 22, category: 'Ketan Susu', name: 'Ketan Susu Original', price: 10000, icon: 'fa-bowl-rice' },
                { id: 23, category: 'Ketan Susu', name: 'Ketan Coklat', price: 13000, icon: 'fa-ice-cream' },
                { id: 24, category: 'Ketan Susu', name: 'Ketan Keju', price: 13000, icon: 'fa-cheese' },
                { id: 25, category: 'Ketan Susu', name: 'Ketan Palm Sugar', price: 13000, icon: 'fa-cube' },
                { id: 26, category: 'Ketan Susu', name: 'Ketan Tiramisu', price: 13000, icon: 'fa-bowl-food' },
                { id: 27, category: 'Ketan Susu', name: 'Ketan Matcha', price: 13000, icon: 'fa-leaf' },
                { id: 28, category: 'Ketan Susu', name: 'Ketan Oreo', price: 13000, icon: 'fa-cookie' },
                // Ketan Susu Mix
                { id: 29, category: 'Ketan Susu Mix', name: 'Coklat - Keju', price: 15000, icon: 'fa-blender' },
                { id: 30, category: 'Ketan Susu Mix', name: 'Coklat - Oreo', price: 15000, icon: 'fa-blender' },
                { id: 31, category: 'Ketan Susu Mix', name: 'Coklat - Matcha', price: 15000, icon: 'fa-blender' },
                { id: 32, category: 'Ketan Susu Mix', name: 'Coklat - Tiramisu', price: 15000, icon: 'fa-blender' },
                { id: 33, category: 'Ketan Susu Mix', name: 'Coklat - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 34, category: 'Ketan Susu Mix', name: 'Keju - Tiramisu', price: 15000, icon: 'fa-blender' },
                { id: 35, category: 'Ketan Susu Mix', name: 'Keju - Oreo', price: 15000, icon: 'fa-blender' },
                { id: 36, category: 'Ketan Susu Mix', name: 'Keju - Matcha', price: 15000, icon: 'fa-blender' },
                { id: 37, category: 'Ketan Susu Mix', name: 'Keju - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 38, category: 'Ketan Susu Mix', name: 'Matcha - Oreo', price: 15000, icon: 'fa-blender' },
                { id: 39, category: 'Ketan Susu Mix', name: 'Matcha - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 40, category: 'Ketan Susu Mix', name: 'Oreo - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 41, category: 'Ketan Susu Mix', name: 'Palm Sugar - Tiramisu', price: 15000, icon: 'fa-blender' },
                  
            ];


        let order = [];
        let salesHistory = JSON.parse(localStorage.getItem('dbonana_sales')) || [];
        let currentMethod = 'cash';

        // Tampilkan Tanggal Hari Ini
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').innerText = new Date().toLocaleDateString('id-ID', options);

        function renderMenu() {
            const section = document.getElementById('menu-section');
            const groups = menuData.reduce((acc, item) => {
                if (!acc[item.category]) acc[item.category] = [];
                acc[item.category].push(item);
                return acc;
            }, {});

            section.innerHTML = '';
            for (const cat in groups) {
                const div = document.createElement('div');
                div.className = 'menu-category';
                div.innerHTML = `<h2>${cat}</h2><div class="menu-grid"></div>`;
                const grid = div.querySelector('.menu-grid');
                groups[cat].forEach(item => {
                    const btn = document.createElement('div');
                    btn.className = 'menu-item';
                    btn.innerHTML = `<i class="fas ${item.icon}"></i><div>${item.name}</div><div class="item-price">Rp ${item.price.toLocaleString()}</div>`;
                    btn.onclick = () => {
                        const existing = order.find(o => o.id === item.id);
                        if (existing) existing.quantity++;
                        else order.push({...item, quantity: 1});
                        renderOrder();
                    };
                    grid.appendChild(btn);
                });
                section.appendChild(div);
            }
        }

        function renderOrder() {
            const container = document.getElementById('order-items');
            container.innerHTML = '';
            let total = 0;
            order.forEach(item => {
                total += item.price * item.quantity;
                container.innerHTML += `<div class="order-item"><div>${item.name} x${item.quantity}</div><div>Rp ${(item.price * item.quantity).toLocaleString()}</div></div>`;
            });
            document.getElementById('total').innerText = `Rp ${total.toLocaleString()}`;
        }

        document.getElementById('pay-btn').onclick = () => {
            if (!order.length) return alert('Keranjang masih kosong!');
            document.getElementById('payment-modal').style.display = 'block';
            updatePaymentUI();
        };

        function updatePaymentUI() {
            const total = order.reduce((a, b) => a + (b.price * b.quantity), 0);
            document.getElementById('payment-details').innerHTML = `<p>Total: Rp ${total.toLocaleString()}</p><input type="number" id="cash-in" placeholder="Masukkan Uang" style="width:100%; padding:10px; margin-top:10px; background:#1a1a2e; color:white; border:1px solid #444;">`;
        }

        document.getElementById('btn-final-pay').onclick = () => {
            const total = order.reduce((a, b) => a + (b.price * b.quantity), 0);
            const totalQty = order.reduce((a, b) => a + b.quantity, 0);
            
            const trx = { 
                date: new Date().toLocaleString('id-ID'), 
                total: total, 
                totalQty: totalQty,
                items: order.map(i => `${i.name} (${i.quantity})`).join(', ') 
            };
            
            salesHistory.push(trx);
            localStorage.setItem('dbonana_sales', JSON.stringify(salesHistory));
            
            document.getElementById('payment-modal').style.display = 'none';
            alert('Transaksi Berhasil!');
            order = []; renderOrder();
        };

        // Render Report Dashboard
        function renderDashboard() {
            const revenue = salesHistory.reduce((a, b) => a + b.total, 0);
            const boxes = salesHistory.reduce((a, b) => a + b.totalQty, 0);
            
            document.getElementById('stat-revenue').innerText = `Rp ${revenue.toLocaleString()}`;
            document.getElementById('stat-boxes').innerText = `${boxes} Box`;

            // Render Table
            const tbody = document.getElementById('sales-table-body');
            tbody.innerHTML = '';
            [...salesHistory].reverse().forEach(s => {
                tbody.innerHTML += `<tr><td>${s.date}</td><td>${s.items}</td><td>Rp ${s.total.toLocaleString()}</td></tr>`;
            });

            // Chart
            const ctx = document.getElementById('sales-chart').getContext('2d');
            if (window.myChart) window.myChart.destroy();
            window.myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: salesHistory.slice(-10).map(s => s.date.split(' ')[1]),
                    datasets: [{ label: 'Omzet Penjualan', data: salesHistory.slice(-10).map(s => s.total), borderColor: '#4a90e2', tension: 0.3 }]
                },
                options: { maintainAspectRatio: false }
            });
        }

        document.getElementById('dashboard-btn').onclick = () => {
            document.querySelectorAll('.main-view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-dashboard').classList.add('active');
            document.getElementById('cashier-btn').classList.remove('active');
            document.getElementById('dashboard-btn').classList.add('active');
            renderDashboard();
        };

        document.getElementById('cashier-btn').onclick = () => {
            document.querySelectorAll('.main-view').forEach(v => v.classList.remove('active'));
            document.getElementById('view-cashier').classList.add('active');
            document.getElementById('dashboard-btn').classList.remove('active');
            document.getElementById('cashier-btn').classList.add('active');
        };

        document.getElementById('delete-report-btn').onclick = () => {
            if(confirm('Hapus semua data penjualan?')) {
                salesHistory = [];
                localStorage.removeItem('dbonana_sales');
                renderDashboard();
            }
        };

        document.getElementById('close-payment-modal').onclick = () => document.getElementById('payment-modal').style.display = 'none';
        document.getElementById('cancel-btn').onclick = () => { order = []; renderOrder(); };

        renderMenu();
    </script>
</body>
</html>

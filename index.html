<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kasir D'bonana Pro - Struk Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        :root {
            --primary-color: #4a90e2; --secondary-color: #f5a623; --background-color: #1e1e2e;
            --surface-color: #2a2a3e; --text-color: #e0e0e0; --success-color: #27ae60;
            --danger-color: #e74c3c; --border-radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        /* Layout Dasar */
        .header { background-color: var(--surface-color); padding: 1rem; display: flex; justify-content: space-between; align-items: center; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .header-actions { display: flex; gap: 0.5rem; }
        .header-btn { background: #3a3a55; color: white; border: none; padding: 0.6rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.8rem; transition: 0.3s; }
        .header-btn.active { background: var(--primary-color); }

        .main-view { display: none; flex: 1; padding: 1rem; overflow: hidden; gap: 1rem; }
        .main-view.active { display: flex; }
        
        /* Menu & Keranjang */
        .menu-section { flex: 2; overflow-y: auto; background: var(--surface-color); padding: 1.5rem; border-radius: var(--border-radius); }
        .category-title { font-size: 1rem; font-weight: 600; margin-bottom: 12px; color: var(--secondary-color); border-left: 4px solid var(--secondary-color); padding-left: 10px; text-transform: uppercase; }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .menu-item { background: var(--background-color); border: 1px solid #3d3d5c; padding: 12px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.2s; }
        .menu-item:hover { border-color: var(--primary-color); background: #25253a; transform: translateY(-3px); }

        .order-section { flex: 1; background: var(--surface-color); border-radius: var(--border-radius); display: flex; flex-direction: column; overflow: hidden; }
        .order-items { flex: 1; overflow-y: auto; padding: 1rem; }
        .order-item { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid #444; padding-bottom: 5px; font-size: 0.85rem; }

        /* Report & Chart */
        .report-container { width: 100%; overflow-y: auto; padding: 10px; }
        .chart-box { background: #1a1a2e; padding: 15px; border-radius: 12px; margin-bottom: 20px; height: 250px; }
        .report-table { width: 100%; border-collapse: collapse; }
        .report-table th, .report-table td { padding: 10px; text-align: left; border-bottom: 1px solid #444; font-size: 0.8rem; }

        /* Modal Umum */
        .modal { display: none; position: fixed; z-index: 1000; left:0; top:0; width:100%; height:100%; background: rgba(0,0,0,0.9); }
        .modal-content { background: var(--surface-color); margin: 5vh auto; padding: 1.5rem; width: 90%; max-width: 400px; border-radius: var(--border-radius); max-height: 90vh; overflow-y: auto; }
        input, select { width: 100%; padding: 10px; background: #1a1a2e; border: 1px solid #444; color: white; border-radius: 8px; margin-bottom: 10px; }

        /* Tampilan Struk di Layar */
        .receipt-card { background: white; color: black; padding: 20px; border-radius: 5px; font-family: 'Courier New', monospace; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .receipt-header { text-align: center; border-bottom: 1px dashed #ccc; padding-bottom: 10px; margin-bottom: 10px; }
        .receipt-line { display: flex; justify-content: space-between; font-size: 0.9rem; margin-bottom: 5px; }

        /* Sembunyikan semua kecuali struk saat print */
        @media print {
            body * { visibility: hidden; }
            .receipt-card, .receipt-card * { visibility: visible; }
            .receipt-card { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; }
        }

        @media (max-width: 768px) { .main-view { flex-direction: column; } .order-section { height: 300px; } }
    </style>
</head>
<body>

    <header class="header">
        <h1>D'BONANA <small style="font-size: 0.6rem; color: var(--primary-color);">POS</small></h1>
        <div class="header-actions">
            <button class="header-btn active" id="btn-cashier" onclick="showView('cashier')">Kasir</button>
            <button class="header-btn" id="btn-report" onclick="showView('report')">Laporan</button>
            <button class="header-btn" onclick="openSettings()"><i class="fas fa-cog"></i></button>
        </div>
    </header>

    <main id="view-cashier" class="main-view active">
        <div class="menu-section" id="menu-display"></div>
        <div class="order-section">
            <div class="order-items" id="order-list"></div>
            <div style="padding: 1rem; background: #1a1a2e;">
                <h3 id="total-price" style="color: var(--secondary-color);">Rp 0</h3>
                <button onclick="openPayment()" class="header-btn" style="width:100%; background:var(--success-color); padding: 12px; font-weight: bold; margin-top:10px;">BAYAR SEKARANG</button>
            </div>
        </div>
    </main>

    <main id="view-report" class="main-view">
        <div class="report-container">
            <div class="chart-box"><canvas id="salesChart"></canvas></div>
            <table class="report-table">
                <thead><tr><th>Tanggal/Waktu</th><th>Total</th><th>Metode</th></tr></thead>
                <tbody id="report-body"></tbody>
            </table>
        </div>
    </main>

    <div id="modal-payment" class="modal">
        <div class="modal-content">
            <h3>Pembayaran</h3><br>
            <select id="pay-method" onchange="updatePayInfo()">
                <option value="Tunai">Tunai / Cash</option>
                <option value="Transfer">Transfer Bank</option>
                <option value="QRIS">QRIS</option>
            </select>
            <div id="pay-info" style="margin:10px 0; text-align:center; font-size:0.85rem;"></div>
            <input type="number" id="pay-amount" placeholder="Jumlah Bayar">
            <button onclick="processTransaction()" class="header-btn" style="width:100%; background:var(--success-color); padding:12px;">PROSES</button>
            <button onclick="closeModal('modal-payment')" class="header-btn" style="width:100%; background:none;">Batal</button>
        </div>
    </div>

    <div id="modal-receipt" class="modal">
        <div class="modal-content" style="max-width: 350px;">
            <div id="print-area" class="receipt-card">
                <div class="receipt-header">
                    <strong id="st-name">D'BONANA</strong><br>
                    <small id="st-addr">Jl. Contoh No. 123</small>
                </div>
                <div id="st-items"></div>
                <div style="border-top: 1px dashed black; margin-top:10px; padding-top:10px;">
                    <div class="receipt-line"><span>TOTAL</span><strong id="st-total"></strong></div>
                    <div class="receipt-line"><span>Metode</span><span id="st-method"></span></div>
                </div>
                <div style="text-align:center; margin-top:15px; font-size:0.7rem;">Terima kasih atas kunjungannya!</div>
            </div>
            <button onclick="window.print()" class="header-btn" style="width:100%; background:var(--primary-color); margin-bottom:8px;">
                <i class="fas fa-print"></i> Cetak Struk
            </button>
            <button onclick="sendWA()" class="header-btn" style="width:100%; background:#25d366; margin-bottom:8px;">
                <i class="fab fa-whatsapp"></i> Kirim WhatsApp
            </button>
            <button onclick="closeModal('modal-receipt')" class="header-btn" style="width:100%; background:none; border:1px solid #555;">Tutup</button>
        </div>
    </div>

    <div id="modal-settings" class="modal">
        <div class="modal-content">
            <h3>Pengaturan Struk & Toko</h3><br>
            <label style="font-size:0.8rem;">Nama Toko:</label>
            <input type="text" id="set-name" placeholder="D'Bonana Pro">
            <label style="font-size:0.8rem;">Alamat Jalan:</label>
            <input type="text" id="set-addr" placeholder="Jl. Diponegoro No. 10">
            <label style="font-size:0.8rem;">Rekening Bank:</label>
            <input type="text" id="set-bank" placeholder="BCA 123456 a/n Nama">
            <label style="font-size:0.8rem;">Upload QRIS:</label>
            <input type="file" accept="image/*" onchange="uploadQRIS(this)">
            <button onclick="saveSettings()" class="header-btn" style="width:100%; background:var(--success-color); margin-top:10px;">Simpan</button>
            <button onclick="closeModal('modal-settings')" class="header-btn" style="width:100%; background:none;">Tutup</button>
        </div>
    </div>

    <script>
        const menu = [
           // D'bonana Menu
                { id: 1, category: 'D\'bonana', name: 'Ori', price: 14000, icon: 'fa-star' },
                { id: 2, category: 'D\'bonana', name: 'Susu', price: 15000, icon: 'fa-glass-water' },
                { id: 3, category: 'D\'bonana', name: 'Coklat', price: 18000, icon: 'fa-ice-cream' },
                { id: 4, category: 'D\'bonana', name: 'Keju', price: 18000, icon: 'fa-cheese' },
                { id: 5, category: 'D\'bonana', name: 'Palm Sugar', price: 18000, icon: 'fa-cube' },
                { id: 6, category: 'D\'bonana', name: 'Tiramisu', price: 18000, icon: 'fa-bowl-food' },
                { id: 7, category: 'D\'bonana', name: 'Matcha', price: 18000, icon: 'fa-leaf' },
                { id: 8, category: 'D\'bonana', name: 'Oreo', price: 18000, icon: 'fa-cookie' },
                // D'bonana Mix
                { id: 7, category: 'Mix', name: 'Coklat - Tiramisu', price: 20000, icon: 'fa-blender' },
                { id: 8, category: 'Mix', name: 'Coklat - Oreo', price: 20000, icon: 'fa-blender' },
                { id: 9, category: 'Mix', name: 'Coklat - Matcha', price: 20000, icon: 'fa-blender' },
                { id: 10, category: 'Mix', name: 'Tiramisu - Matcha', price: 20000, icon: 'fa-blender' },
                { id: 11, category: 'Mix', name: 'Tiramisu - Oreo', price: 20000, icon: 'fa-blender' },
                { id: 12, category: 'Mix', name: 'Matcha - Oreo', price: 20000, icon: 'fa-blender' },
                { id: 13, category: 'Mix', name: 'palm-matcha', price: 20000, icon: 'fa-blender' },
                { id: 14, category: 'Mix', name: 'palm-coklat', price: 20000, icon: 'fa-blender' },
                { id: 15, category: 'Mix', name: 'palm-tiramisu', price: 20000, icon: 'fa-blender' },
                { id: 16, category: 'Mix', name: 'palm-oreo', price: 20000, icon: 'fa-blender' },
                { id: 17, category: 'Mix', name: 'Keju - Coklat', price: 23000, icon: 'fa-blender' },
                { id: 18, category: 'Mix', name: 'Keju - Tiramisu', price: 23000, icon: 'fa-blender' },
                { id: 19, category: 'Mix', name: 'Keju - Matcha', price: 23000, icon: 'fa-blender' },
                { id: 20, category: 'Mix', name: 'Keju - Oreo', price: 23000, icon: 'fa-blender' },
                { id: 21, category: 'Mix', name: 'keju-palm', price: 23000, icon: 'fa-blender' },
                                 
                // Ketan Susu Menu
                { id: 22, category: 'Ketan Susu', name: 'Ketan Susu Original', price: 10000, icon: 'fa-bowl-rice' },
                { id: 23, category: 'Ketan Susu', name: 'Ketan Coklat', price: 13000, icon: 'fa-ice-cream' },
                { id: 24, category: 'Ketan Susu', name: 'Ketan Keju', price: 13000, icon: 'fa-cheese' },
                { id: 25, category: 'Ketan Susu', name: 'Ketan Palm Sugar', price: 13000, icon: 'fa-cube' },
                { id: 26, category: 'Ketan Susu', name: 'Ketan Tiramisu', price: 13000, icon: 'fa-bowl-food' },
                { id: 27, category: 'Ketan Susu', name: 'Ketan Matcha', price: 13000, icon: 'fa-leaf' },
                { id: 28, category: 'Ketan Susu', name: 'Ketan Oreo', price: 13000, icon: 'fa-cookie' },
                // Ketan Susu Mix
                { id: 29, category: 'Ketan Susu Mix', name: 'Coklat - Keju', price: 15000, icon: 'fa-blender' },
                { id: 30, category: 'Ketan Susu Mix', name: 'Coklat - Oreo', price: 15000, icon: 'fa-blender' },
                { id: 31, category: 'Ketan Susu Mix', name: 'Coklat - Matcha', price: 15000, icon: 'fa-blender' },
                { id: 32, category: 'Ketan Susu Mix', name: 'Coklat - Tiramisu', price: 15000, icon: 'fa-blender' },
                { id: 33, category: 'Ketan Susu Mix', name: 'Coklat - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 34, category: 'Ketan Susu Mix', name: 'Keju - Tiramisu', price: 15000, icon: 'fa-blender' },
                { id: 35, category: 'Ketan Susu Mix', name: 'Keju - Oreo', price: 15000, icon: 'fa-blender' },
                { id: 36, category: 'Ketan Susu Mix', name: 'Keju - Matcha', price: 15000, icon: 'fa-blender' },
                { id: 37, category: 'Ketan Susu Mix', name: 'Keju - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 38, category: 'Ketan Susu Mix', name: 'Matcha - Oreo', price: 15000, icon: 'fa-blender' },
                { id: 39, category: 'Ketan Susu Mix', name: 'Matcha - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 40, category: 'Ketan Susu Mix', name: 'Oreo - Palm Sugar', price: 15000, icon: 'fa-blender' },
                { id: 41, category: 'Ketan Susu Mix', name: 'Palm Sugar - Tiramisu', price: 15000, icon: 'fa-blender' },
                  
            ];


        let cart = [];
        let sales = JSON.parse(localStorage.getItem('sales_db')) || [];
        let config = JSON.parse(localStorage.getItem('config_db')) || { name: "D'BONANA", addr: "Jl. Kasir No. 1", bank: "", qris: "" };
        let myChart = null;
        let lastTrx = null;

        function renderMenu() {
            const display = document.getElementById('menu-display');
            display.innerHTML = '';
            const categories = [...new Set(menu.map(item => item.category))];
            categories.forEach(cat => {
                let html = `<div class="category-title">${cat}</div><div class="menu-grid">`;
                menu.filter(i => i.category === cat).forEach(item => {
                    html += `<div class="menu-item" onclick="addToCart(${item.id})">
                        <i class="fas ${item.icon}" style="color:var(--primary-color)"></i><br>
                        <small>${item.name}</small><br><strong>Rp ${item.price.toLocaleString()}</strong>
                    </div>`;
                });
                display.innerHTML += html + `</div>`;
            });
        }

        function addToCart(id) {
            const item = menu.find(m => m.id === id);
            const exist = cart.find(c => c.id === id);
            if(exist) exist.qty++; else cart.push({...item, qty: 1});
            renderCart();
        }

        function renderCart() {
            const list = document.getElementById('order-list');
            list.innerHTML = ''; let total = 0;
            cart.forEach(item => { total += item.price * item.qty; list.innerHTML += `<div class="order-item"><span>${item.qty}x ${item.name}</span><span>Rp ${(item.price*item.qty).toLocaleString()}</span></div>`; });
            document.getElementById('total-price').innerText = `Rp ${total.toLocaleString()}`;
        }

        function processTransaction() {
            if(cart.length === 0) return;
            const total = cart.reduce((a,b) => a + (b.price * b.qty), 0);
            const time = new Date().toLocaleString('id-ID');
            lastTrx = { time, items: [...cart], total, method: document.getElementById('pay-method').value };
            
            sales.push(lastTrx);
            localStorage.setItem('sales_db', JSON.stringify(sales));
            
            // Siapkan Struk
            document.getElementById('st-name').innerText = config.name;
            document.getElementById('st-addr').innerText = config.addr;
            document.getElementById('st-total').innerText = `Rp ${total.toLocaleString()}`;
            document.getElementById('st-method').innerText = lastTrx.method;
            let itemsHtml = '';
            lastTrx.items.forEach(i => { itemsHtml += `<div class="receipt-line"><span>${i.qty}x ${i.name}</span><span>${(i.qty*i.price).toLocaleString()}</span></div>`; });
            document.getElementById('st-items').innerHTML = itemsHtml;

            cart = []; renderCart(); 
            closeModal('modal-payment');
            document.getElementById('modal-receipt').style.display = 'block';
        }

        function sendWA() {
            let msg = `*${config.name}*\n${config.addr}\n--------------------\n`;
            lastTrx.items.forEach(i => { msg += `${i.qty}x ${i.name} = Rp ${(i.qty*i.price).toLocaleString()}\n`; });
            msg += `--------------------\n*TOTAL: Rp ${lastTrx.total.toLocaleString()}*\nMetode: ${lastTrx.method}\n\nTerima Kasih!`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function showView(v) {
            document.querySelectorAll('.main-view, .header-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-'+v).classList.add('active');
            document.getElementById('btn-'+v).classList.add('active');
            if(v === 'report') renderReport();
        }

        function renderReport() {
            const body = document.getElementById('report-body');
            body.innerHTML = ''; let labels = [], data = [];
            sales.slice(-10).forEach(s => {
                body.innerHTML = `<tr><td>${s.time}</td><td>Rp ${s.total.toLocaleString()}</td><td>${s.method}</td></tr>` + body.innerHTML;
                labels.push(s.time.split(' ')[1]); data.push(s.total);
            });
            const ctx = document.getElementById('salesChart').getContext('2d');
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, { type: 'line', data: { labels, datasets: [{ label: 'Omzet', data, borderColor: '#4a90e2', tension: 0.3 }] } });
        }

        function openSettings() {
            document.getElementById('modal-settings').style.display = 'block';
            document.getElementById('set-name').value = config.name;
            document.getElementById('set-addr').value = config.addr;
            document.getElementById('set-bank').value = config.bank;
        }

        function saveSettings() {
            config.name = document.getElementById('set-name').value;
            config.addr = document.getElementById('set-addr').value;
            config.bank = document.getElementById('set-bank').value;
            localStorage.setItem('config_db', JSON.stringify(config));
            closeModal('modal-settings');
        }

        function uploadQRIS(input) {
            const reader = new FileReader();
            reader.onload = (e) => config.qris = e.target.result;
            reader.readAsDataURL(input.files[0]);
        }

        function updatePayInfo() {
            const m = document.getElementById('pay-method').value;
            const info = document.getElementById('pay-info');
            if(m === 'Transfer') info.innerText = "Kirim ke: " + (config.bank || "Belum Diatur");
            else if(m === 'QRIS') info.innerHTML = config.qris ? `<img src="${config.qris}" width="100">` : "QRIS Belum Ada";
            else info.innerText = "Terima Tunai";
        }

        function openPayment() { if(cart.length > 0) { document.getElementById('modal-payment').style.display = 'block'; updatePayInfo(); } }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        renderMenu();
    </script>
</body>
</html>
